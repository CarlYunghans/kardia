// This proivdes a list of everyone that is on the server.
$Version=2$
whoson_browser "widget/component-decl"
    {
    height=100; width=282;
    
    // Parameters
    profile_window "widget/parameter" {type="object"; }
    
    // Actions
    
    whoson_table "widget/table"
        {
        sql = " select
                    img='/apps/kardia/images/icons/person.gif',
                    :ud:s_status,
                    :ud:s_username,
                    :u:description,
                    :s:name,
                    :s:session_cnt
                from
                    /sys/cx.sysinfo/users s,
                    /apps/kardia/data/Users.uxu u,
                    /apps/kardia/data/Kardia_DB/s_user_data/rows ud
                where
                    :s:name = :u:name and
                    :s:name *= :ud:s_username
                ";
                
            mode="dynamicrow";
            width=282;
            height=100;
            
            img "widget/table-column" {title=""; width=24;}
            name "widget/table-column" {title="User Name"; width=200;}
    
        }
    
    whoson_vlayout "widget/vbox"
        {
        height=100; width=282;
        x=0; y=100;
        spacing=2;
        
        // Horizontal pane for the header
        header_pane "widget/pane"
            {
            height=20; width=282;
            background="/apps/kardia/images/bg/blue_gradient.png";
            style="flat";
        
            // Header for table
            whoson_header "widget/hbox"
                {
                height=20; width=282;
                
                img_header "widget/label"
                    {
                    text="";
                    width=24;
                    }
                    
                name_header "widget/label"
                    {
                    text="Name";
                    width=80;
                    }
                    
                status_header "widget/label"
                    {
                    text="Status";
                    width = 178;
                    }
                
                }
            }
        
        // Begin making the table itself
        whoson_table_vbox "widget/vbox"
            {
            width=282;
            spacing=2;
        
            // Now autogenerate the rest of the rows to the table.
            whoson_lister "widget/repeat"
                {		    
                sql = " select
                                img='/apps/kardia/images/icons/person.gif',
                                :ud:s_status,
                                :ud:s_username,
                                :u:description,
                                :s:name,
                                :s:session_cnt
                        from
                                /sys/cx.sysinfo/users s,
                                /apps/kardia/data/Users.uxu u,
                                /apps/kardia/data/Kardia_DB/s_user_data/rows ud
                        where
                                :s:name = :u:name and
                                :s:name *= :ud:s_username
                        ";
                
                row_pane "widget/pane"
                    {
                    width=282; height=18;
                    bgcolor="white";
                    style="flat";
                                                
                    user_image "widget/image"
                        {
                        width=16; height=16; x=1; y=1;
                        source="/apps/kardia/images/icons/person.gif";
                        }
                        
                    user_name "widget/label"
                        {
                        width=200; height=18; x=22; y=0;
                        text=runserver(:whoson_lister:description);
                        }
                    
                    whitebg "widget/pane"
                        {
                        height=18; width=200; x=105; y=0;
                        style="flat";
                        bgcolor="white";
                        
                        user_status "widget/label"
                            {
                            height=18; width=200; x=3; y=0;
                            text=runserver(:whoson_lister:s_status);
                            }
                        }
                    
                    chat_button "widget/imagebutton"
                        {
                        x=246; y=1;width=16;height=16;
                        image="/apps/kardia/images/icons/chat.png";
                        condition=runserver(:whoson_lister:name != user_name());
                        }
                        
                    profile_button "widget/imagebutton"
                        {
                        x=262; y=1; width=16; height=16;
                        image="/apps/kardia/images/icons/user.gif";
                        
                        // This opens up the profile window when requested
                        open_profile_window_connector "widget/connector"
                            {
                            event=Click;
                            target=profile_window;
                            action=Instantiate;
                            specimen=runserver(:whoson_lister:name + " ");
                            }
                        }
                    } // End row_pane
                    
                } // End whoson_lister
            } // End whoson_table_vbox
        } // End whoson_vlayout
    
    }